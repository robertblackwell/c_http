<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>http_in_c: /home/robert/Projects/http_in_c/http_in_c/sync/worker.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">http_in_c
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_06774630331b9c06955f65296197b4db.html">http_in_c</a></li><li class="navelem"><a class="el" href="dir_6af49522e3e5085226d2a1481902ead4.html">sync</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">worker.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="sync_8h_source.html">http_in_c/sync/sync.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="sync__internal_8h_source.html">http_in_c/sync/sync_internal.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="alloc_8h_source.html">http_in_c/common/alloc.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="utils_8h_source.html">http_in_c/common/utils.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="queue_8h_source.html">http_in_c/common/queue.h</a>&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
<code>#include &lt;assert.h&gt;</code><br />
<code>#include &lt;pthread.h&gt;</code><br />
<code>#include &lt;rbl/macros.h&gt;</code><br />
<code>#include &lt;rbl/logger.h&gt;</code><br />
<code>#include &lt;rbl/check_tag.h&gt;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a147f84824eaf961ee0be4a5b84430f8d"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="worker_8c.html#a147f84824eaf961ee0be4a5b84430f8d">on_message_handler_2</a> (<a class="el" href="group__group__message.html#ga33b8e4c347991edbbe1d3d7d6f77c9a1">HttpMessageRef</a> response_ptr, <a class="el" href="sync_8h.html#a021702523caac68049d2ac01aa8e317c">sync_worker_t</a> *context)</td></tr>
<tr class="separator:a147f84824eaf961ee0be4a5b84430f8d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a468dfd8b17fe4455d4ee9edf1681652d"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="worker_8c.html#a468dfd8b17fe4455d4ee9edf1681652d">connection_message_handler</a> (<a class="el" href="group__group__message.html#ga33b8e4c347991edbbe1d3d7d6f77c9a1">HttpMessageRef</a> request_ptr, <a class="el" href="sync_8h.html#a752ab692df8a861d059e73584677055e">sync_worker_r</a> context)</td></tr>
<tr class="separator:a468dfd8b17fe4455d4ee9edf1681652d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae53a57622d7a531ef6f263400e3e2701"><td class="memItemLeft" align="right" valign="top"><a class="el" href="sync_8h.html#a752ab692df8a861d059e73584677055e">sync_worker_r</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="worker_8c.html#ae53a57622d7a531ef6f263400e3e2701">sync_worker_new</a> (int listen_socket, int ident, size_t read_buffer_size, <a class="el" href="sync_8h.html#ac3206246f99ad03084983d477968c826">SyncAppMessageHandler</a> app_handler)</td></tr>
<tr class="separator:ae53a57622d7a531ef6f263400e3e2701"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a85d599345bf06d6e690cdaf2ee71eaee"><td class="memItemLeft" align="right" valign="top"><a class="el" href="rl__internal_8h.html#a691e4d5de4b427a20b12e6a256b5406e">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="worker_8c.html#a85d599345bf06d6e690cdaf2ee71eaee">sync_worker_dispose</a> (<a class="el" href="sync_8h.html#a752ab692df8a861d059e73584677055e">sync_worker_r</a> wref)</td></tr>
<tr class="separator:a85d599345bf06d6e690cdaf2ee71eaee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8613300b9965b70ad6d2560b27e86d81"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="rl__internal_8h.html#a691e4d5de4b427a20b12e6a256b5406e">void</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="worker_8c.html#a8613300b9965b70ad6d2560b27e86d81">Worker_main</a> (<a class="el" href="rl__internal_8h.html#a691e4d5de4b427a20b12e6a256b5406e">void</a> *data)</td></tr>
<tr class="separator:a8613300b9965b70ad6d2560b27e86d81"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a479bab3b4bd0b89bd19b2b378399f57c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="worker_8c.html#a479bab3b4bd0b89bd19b2b378399f57c">sync_worker_start</a> (<a class="el" href="sync_8h.html#a752ab692df8a861d059e73584677055e">sync_worker_r</a> wref)</td></tr>
<tr class="separator:a479bab3b4bd0b89bd19b2b378399f57c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5b42c60028ca16aacb842f2276d81724"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="worker_8c.html#a5b42c60028ca16aacb842f2276d81724">sync_worker_socketfd</a> (<a class="el" href="sync_8h.html#a752ab692df8a861d059e73584677055e">sync_worker_r</a> wref)</td></tr>
<tr class="separator:a5b42c60028ca16aacb842f2276d81724"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a73763560a91e909a64860ba63ccd7c6e"><td class="memItemLeft" align="right" valign="top">pthread_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="worker_8c.html#a73763560a91e909a64860ba63ccd7c6e">sync_worker_pthread</a> (<a class="el" href="sync_8h.html#a752ab692df8a861d059e73584677055e">sync_worker_r</a> wref)</td></tr>
<tr class="separator:a73763560a91e909a64860ba63ccd7c6e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6752f79a63aa1b11deca95d1caf755f5"><td class="memItemLeft" align="right" valign="top"><a class="el" href="rl__internal_8h.html#a691e4d5de4b427a20b12e6a256b5406e">void</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="worker_8c.html#a6752f79a63aa1b11deca95d1caf755f5">sync_worker_join</a> (<a class="el" href="sync_8h.html#a752ab692df8a861d059e73584677055e">sync_worker_r</a> wref)</td></tr>
<tr class="separator:a6752f79a63aa1b11deca95d1caf755f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a468dfd8b17fe4455d4ee9edf1681652d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a468dfd8b17fe4455d4ee9edf1681652d">&#9670;&nbsp;</a></span>connection_message_handler()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int connection_message_handler </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__group__message.html#ga33b8e4c347991edbbe1d3d7d6f77c9a1">HttpMessageRef</a>&#160;</td>
          <td class="paramname"><em>request_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="sync_8h.html#a752ab692df8a861d059e73584677055e">sync_worker_r</a>&#160;</td>
          <td class="paramname"><em>context</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a147f84824eaf961ee0be4a5b84430f8d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a147f84824eaf961ee0be4a5b84430f8d">&#9670;&nbsp;</a></span>on_message_handler_2()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int on_message_handler_2 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__group__message.html#ga33b8e4c347991edbbe1d3d7d6f77c9a1">HttpMessageRef</a>&#160;</td>
          <td class="paramname"><em>response_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="sync_8h.html#a021702523caac68049d2ac01aa8e317c">sync_worker_t</a> *&#160;</td>
          <td class="paramname"><em>context</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a85d599345bf06d6e690cdaf2ee71eaee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a85d599345bf06d6e690cdaf2ee71eaee">&#9670;&nbsp;</a></span>sync_worker_dispose()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="rl__internal_8h.html#a691e4d5de4b427a20b12e6a256b5406e">void</a> sync_worker_dispose </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sync_8h.html#a752ab692df8a861d059e73584677055e">sync_worker_r</a>&#160;</td>
          <td class="paramname"><em>wref</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a6752f79a63aa1b11deca95d1caf755f5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6752f79a63aa1b11deca95d1caf755f5">&#9670;&nbsp;</a></span>sync_worker_join()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="rl__internal_8h.html#a691e4d5de4b427a20b12e6a256b5406e">void</a> sync_worker_join </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sync_8h.html#a752ab692df8a861d059e73584677055e">sync_worker_r</a>&#160;</td>
          <td class="paramname"><em>wref</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ae53a57622d7a531ef6f263400e3e2701"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae53a57622d7a531ef6f263400e3e2701">&#9670;&nbsp;</a></span>sync_worker_new()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="sync_8h.html#a752ab692df8a861d059e73584677055e">sync_worker_r</a> sync_worker_new </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>listen_socket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ident</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>read_buffer_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="sync_8h.html#ac3206246f99ad03084983d477968c826">SyncAppMessageHandler</a>&#160;</td>
          <td class="paramname"><em>app_handler</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>SYNC_WORKER_QUEUE</p>
<p>there are 2 ways that the server and worker can interact in regard to listening for incoming connections.</p><ul>
<li>the first method SYNC_WORKER_QUEUE is defined. The main thread does the listening and when a connection is made it passes the socket to a worker thread via a synchronized queue</li>
<li>the second method SYNC_WORKER_QUEUE NOT defined - the main thread creates the listener socket but each worker issues its own accept() call - the Linux OS ensures that only one thread waiting for an incoming connection will be worken up to handle the connection. The main thread does nothing after starting the worker threads. It joust issues pthread_join() calls to wait for all the workers to terminate. </li>
</ul>

</div>
</div>
<a id="a73763560a91e909a64860ba63ccd7c6e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a73763560a91e909a64860ba63ccd7c6e">&#9670;&nbsp;</a></span>sync_worker_pthread()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_t sync_worker_pthread </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sync_8h.html#a752ab692df8a861d059e73584677055e">sync_worker_r</a>&#160;</td>
          <td class="paramname"><em>wref</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a5b42c60028ca16aacb842f2276d81724"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5b42c60028ca16aacb842f2276d81724">&#9670;&nbsp;</a></span>sync_worker_socketfd()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sync_worker_socketfd </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sync_8h.html#a752ab692df8a861d059e73584677055e">sync_worker_r</a>&#160;</td>
          <td class="paramname"><em>wref</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a479bab3b4bd0b89bd19b2b378399f57c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a479bab3b4bd0b89bd19b2b378399f57c">&#9670;&nbsp;</a></span>sync_worker_start()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sync_worker_start </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sync_8h.html#a752ab692df8a861d059e73584677055e">sync_worker_r</a>&#160;</td>
          <td class="paramname"><em>wref</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a8613300b9965b70ad6d2560b27e86d81"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8613300b9965b70ad6d2560b27e86d81">&#9670;&nbsp;</a></span>Worker_main()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="rl__internal_8h.html#a691e4d5de4b427a20b12e6a256b5406e">void</a>* Worker_main </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="rl__internal_8h.html#a691e4d5de4b427a20b12e6a256b5406e">void</a> *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>this is the terminate signal</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
