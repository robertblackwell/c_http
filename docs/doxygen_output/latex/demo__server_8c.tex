\hypertarget{demo__server_8c}{}\doxysection{/home/robert/\+Projects/http\+\_\+in\+\_\+c/http\+\_\+in\+\_\+c/demo\+\_\+protocol/demo\+\_\+server.c File Reference}
\label{demo__server_8c}\index{/home/robert/Projects/http\_in\_c/http\_in\_c/demo\_protocol/demo\_server.c@{/home/robert/Projects/http\_in\_c/http\_in\_c/demo\_protocol/demo\_server.c}}
{\ttfamily \#include $<$http\+\_\+in\+\_\+c/demo\+\_\+protocol/demo\+\_\+server.\+h$>$}\newline
{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$unistd.\+h$>$}\newline
{\ttfamily \#include $<$assert.\+h$>$}\newline
{\ttfamily \#include $<$errno.\+h$>$}\newline
{\ttfamily \#include $<$fcntl.\+h$>$}\newline
{\ttfamily \#include $<$sys/epoll.\+h$>$}\newline
{\ttfamily \#include $<$rbl/logger.\+h$>$}\newline
{\ttfamily \#include $<$rbl/check\+\_\+tag.\+h$>$}\newline
{\ttfamily \#include $<$http\+\_\+in\+\_\+c/common/alloc.\+h$>$}\newline
{\ttfamily \#include $<$http\+\_\+in\+\_\+c/common/utils.\+h$>$}\newline
{\ttfamily \#include $<$http\+\_\+in\+\_\+c/common/socket\+\_\+functions.\+h$>$}\newline
{\ttfamily \#include \char`\"{}demo\+\_\+handler.\+h\char`\"{}}\newline
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static \mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} \mbox{\hyperlink{demo__server_8c_a360e6a7814e44dc98e27029384d9f1b5}{set\+\_\+non\+\_\+blocking}} (\mbox{\hyperlink{socket__functions_8h_a9fc51c768239c2b2154e02ea796a6115}{socket\+\_\+handle\+\_\+t}} socket)
\item 
\mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} \mbox{\hyperlink{demo__server_8c_a811d2189090f34fce6fac9dc89598226}{on\+\_\+event\+\_\+listening}} (\mbox{\hyperlink{group__runloop_ga3be36d97cf9a7f7b4180b71d95cde72e}{Runloop\+Ref}} rl, \mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} $\ast$arg\+\_\+server\+\_\+ref)
\item 
static \mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} \mbox{\hyperlink{demo__server_8c_aee25c7293dde052a0e14352aef694557}{on\+\_\+handler\+\_\+completion\+\_\+cb}} (\mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} $\ast$void\+\_\+server\+\_\+ref, \mbox{\hyperlink{demo__handler_8h_a4d48a634822511a3654867fe256e50a2}{Demo\+Handler\+Ref}} handler\+\_\+ref)
\item 
\mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} \mbox{\hyperlink{demo__server_8c_aa497831e33430c966f5027c59c4f09ec}{demo\+\_\+server\+\_\+init}} (\mbox{\hyperlink{demo__server_8h_a4db6a9ea0ba3d4d27aa1bbf5c4da546c}{Demo\+Server\+Ref}} sref, int port, char const $\ast$host, int listen\+\_\+fd, \mbox{\hyperlink{demo__server_8h_a87a7bd74bbb269cebd3f7de92853dc0d}{Demo\+Process\+Request\+Function}} process\+\_\+request)
\item 
\mbox{\hyperlink{demo__server_8h_a4db6a9ea0ba3d4d27aa1bbf5c4da546c}{Demo\+Server\+Ref}} \mbox{\hyperlink{demo__server_8c_a05debfda3674472063410df0d1f20913}{demo\+\_\+server\+\_\+new}} (int port, char const $\ast$host, int listen\+\_\+fd, \mbox{\hyperlink{demo__server_8h_a87a7bd74bbb269cebd3f7de92853dc0d}{Demo\+Process\+Request\+Function}} process\+\_\+request)
\item 
\mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} \mbox{\hyperlink{demo__server_8c_ab85c53252d957fc55533bab91106efad}{demo\+\_\+server\+\_\+free}} (\mbox{\hyperlink{demo__server_8h_a4db6a9ea0ba3d4d27aa1bbf5c4da546c}{Demo\+Server\+Ref}} this)
\item 
\mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} \mbox{\hyperlink{demo__server_8c_a9760ebbbd618aa238f63c66c92c45459}{demo\+\_\+server\+\_\+listen}} (\mbox{\hyperlink{demo__server_8h_a4db6a9ea0ba3d4d27aa1bbf5c4da546c}{Demo\+Server\+Ref}} sref)
\item 
\mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} \mbox{\hyperlink{demo__server_8c_a798ef57140963818a8f12d7cd5d69c15}{demo\+\_\+server\+\_\+terminate}} (\mbox{\hyperlink{demo__server_8h_a4db6a9ea0ba3d4d27aa1bbf5c4da546c}{Demo\+Server\+Ref}} this)
\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
static \mbox{\hyperlink{demo__handler_8h_a4d48a634822511a3654867fe256e50a2}{Demo\+Handler\+Ref}} \mbox{\hyperlink{demo__server_8c_abf78d740d13e64a6e7d9765429ba186e}{my\+\_\+only\+\_\+client}}
\end{DoxyCompactItemize}


\doxysubsection{Function Documentation}
\mbox{\Hypertarget{demo__server_8c_ab85c53252d957fc55533bab91106efad}\label{demo__server_8c_ab85c53252d957fc55533bab91106efad}} 
\index{demo\_server.c@{demo\_server.c}!demo\_server\_free@{demo\_server\_free}}
\index{demo\_server\_free@{demo\_server\_free}!demo\_server.c@{demo\_server.c}}
\doxysubsubsection{\texorpdfstring{demo\_server\_free()}{demo\_server\_free()}}
{\footnotesize\ttfamily \mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} demo\+\_\+server\+\_\+free (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{demo__server_8h_a4db6a9ea0ba3d4d27aa1bbf5c4da546c}{Demo\+Server\+Ref}}}]{this }\end{DoxyParamCaption})}

\mbox{\Hypertarget{demo__server_8c_aa497831e33430c966f5027c59c4f09ec}\label{demo__server_8c_aa497831e33430c966f5027c59c4f09ec}} 
\index{demo\_server.c@{demo\_server.c}!demo\_server\_init@{demo\_server\_init}}
\index{demo\_server\_init@{demo\_server\_init}!demo\_server.c@{demo\_server.c}}
\doxysubsubsection{\texorpdfstring{demo\_server\_init()}{demo\_server\_init()}}
{\footnotesize\ttfamily \mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} demo\+\_\+server\+\_\+init (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{demo__server_8h_a4db6a9ea0ba3d4d27aa1bbf5c4da546c}{Demo\+Server\+Ref}}}]{sref,  }\item[{int}]{port,  }\item[{char const $\ast$}]{host,  }\item[{int}]{listen\+\_\+fd,  }\item[{\mbox{\hyperlink{demo__server_8h_a87a7bd74bbb269cebd3f7de92853dc0d}{Demo\+Process\+Request\+Function}}}]{process\+\_\+request }\end{DoxyParamCaption})}

\mbox{\Hypertarget{demo__server_8c_a9760ebbbd618aa238f63c66c92c45459}\label{demo__server_8c_a9760ebbbd618aa238f63c66c92c45459}} 
\index{demo\_server.c@{demo\_server.c}!demo\_server\_listen@{demo\_server\_listen}}
\index{demo\_server\_listen@{demo\_server\_listen}!demo\_server.c@{demo\_server.c}}
\doxysubsubsection{\texorpdfstring{demo\_server\_listen()}{demo\_server\_listen()}}
{\footnotesize\ttfamily \mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} demo\+\_\+server\+\_\+listen (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{demo__server_8h_a4db6a9ea0ba3d4d27aa1bbf5c4da546c}{Demo\+Server\+Ref}}}]{sref }\end{DoxyParamCaption})}

\mbox{\Hypertarget{demo__server_8c_a05debfda3674472063410df0d1f20913}\label{demo__server_8c_a05debfda3674472063410df0d1f20913}} 
\index{demo\_server.c@{demo\_server.c}!demo\_server\_new@{demo\_server\_new}}
\index{demo\_server\_new@{demo\_server\_new}!demo\_server.c@{demo\_server.c}}
\doxysubsubsection{\texorpdfstring{demo\_server\_new()}{demo\_server\_new()}}
{\footnotesize\ttfamily \mbox{\hyperlink{demo__server_8h_a4db6a9ea0ba3d4d27aa1bbf5c4da546c}{Demo\+Server\+Ref}} demo\+\_\+server\+\_\+new (\begin{DoxyParamCaption}\item[{int}]{port,  }\item[{char const $\ast$}]{host,  }\item[{int}]{listen\+\_\+fd,  }\item[{\mbox{\hyperlink{demo__server_8h_a87a7bd74bbb269cebd3f7de92853dc0d}{Demo\+Process\+Request\+Function}}}]{process\+\_\+request }\end{DoxyParamCaption})}

Create a new server object. 
\begin{DoxyParams}{Parameters}
{\em port} & The localhost\+:port on which the server will listen \\
\hline
{\em handler} & A function conforming to Xr\+Handler\+Function (see aio\+\_\+api/handler.\+h) which will be called to handle all requests that are parsed successfully. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}

\end{DoxyReturn}
\mbox{\Hypertarget{demo__server_8c_a798ef57140963818a8f12d7cd5d69c15}\label{demo__server_8c_a798ef57140963818a8f12d7cd5d69c15}} 
\index{demo\_server.c@{demo\_server.c}!demo\_server\_terminate@{demo\_server\_terminate}}
\index{demo\_server\_terminate@{demo\_server\_terminate}!demo\_server.c@{demo\_server.c}}
\doxysubsubsection{\texorpdfstring{demo\_server\_terminate()}{demo\_server\_terminate()}}
{\footnotesize\ttfamily \mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} demo\+\_\+server\+\_\+terminate (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{demo__server_8h_a4db6a9ea0ba3d4d27aa1bbf5c4da546c}{Demo\+Server\+Ref}}}]{this }\end{DoxyParamCaption})}

\mbox{\Hypertarget{demo__server_8c_a811d2189090f34fce6fac9dc89598226}\label{demo__server_8c_a811d2189090f34fce6fac9dc89598226}} 
\index{demo\_server.c@{demo\_server.c}!on\_event\_listening@{on\_event\_listening}}
\index{on\_event\_listening@{on\_event\_listening}!demo\_server.c@{demo\_server.c}}
\doxysubsubsection{\texorpdfstring{on\_event\_listening()}{on\_event\_listening()}}
{\footnotesize\ttfamily \mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} on\+\_\+event\+\_\+listening (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{group__runloop_ga3be36d97cf9a7f7b4180b71d95cde72e}{Runloop\+Ref}}}]{rl,  }\item[{\mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} $\ast$}]{arg\+\_\+server\+\_\+ref }\end{DoxyParamCaption})}

\mbox{\Hypertarget{demo__server_8c_aee25c7293dde052a0e14352aef694557}\label{demo__server_8c_aee25c7293dde052a0e14352aef694557}} 
\index{demo\_server.c@{demo\_server.c}!on\_handler\_completion\_cb@{on\_handler\_completion\_cb}}
\index{on\_handler\_completion\_cb@{on\_handler\_completion\_cb}!demo\_server.c@{demo\_server.c}}
\doxysubsubsection{\texorpdfstring{on\_handler\_completion\_cb()}{on\_handler\_completion\_cb()}}
{\footnotesize\ttfamily static \mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} on\+\_\+handler\+\_\+completion\+\_\+cb (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} $\ast$}]{void\+\_\+server\+\_\+ref,  }\item[{\mbox{\hyperlink{demo__handler_8h_a4d48a634822511a3654867fe256e50a2}{Demo\+Handler\+Ref}}}]{handler\+\_\+ref }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

remove the departing handle from the handler\+\_\+list

BEWARE -\/ the list remove call also free()\textquotesingle{}s the handle object

For the moment this fixed the following TODO

@\+TODO -\/ this needs fixing -\/ FIXED pass NULL as dispose function in demo\+\_\+server\+\_\+init

demo\+\_\+handler\+\_\+free(handler\+\_\+ref);\mbox{\Hypertarget{demo__server_8c_a360e6a7814e44dc98e27029384d9f1b5}\label{demo__server_8c_a360e6a7814e44dc98e27029384d9f1b5}} 
\index{demo\_server.c@{demo\_server.c}!set\_non\_blocking@{set\_non\_blocking}}
\index{set\_non\_blocking@{set\_non\_blocking}!demo\_server.c@{demo\_server.c}}
\doxysubsubsection{\texorpdfstring{set\_non\_blocking()}{set\_non\_blocking()}}
{\footnotesize\ttfamily static \mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} set\+\_\+non\+\_\+blocking (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{socket__functions_8h_a9fc51c768239c2b2154e02ea796a6115}{socket\+\_\+handle\+\_\+t}}}]{socket }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



\doxysubsection{Variable Documentation}
\mbox{\Hypertarget{demo__server_8c_abf78d740d13e64a6e7d9765429ba186e}\label{demo__server_8c_abf78d740d13e64a6e7d9765429ba186e}} 
\index{demo\_server.c@{demo\_server.c}!my\_only\_client@{my\_only\_client}}
\index{my\_only\_client@{my\_only\_client}!demo\_server.c@{demo\_server.c}}
\doxysubsubsection{\texorpdfstring{my\_only\_client}{my\_only\_client}}
{\footnotesize\ttfamily \mbox{\hyperlink{demo__handler_8h_a4d48a634822511a3654867fe256e50a2}{Demo\+Handler\+Ref}} my\+\_\+only\+\_\+client\hspace{0.3cm}{\ttfamily [static]}}

