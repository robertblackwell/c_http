\hypertarget{sync__connection_8c}{}\doxysection{/home/robert/\+Projects/http\+\_\+in\+\_\+c/http\+\_\+in\+\_\+c/sync/sync\+\_\+connection.c File Reference}
\label{sync__connection_8c}\index{/home/robert/Projects/http\_in\_c/http\_in\_c/sync/sync\_connection.c@{/home/robert/Projects/http\_in\_c/http\_in\_c/sync/sync\_connection.c}}
{\ttfamily \#include $<$rbl/macros.\+h$>$}\newline
{\ttfamily \#include $<$http\+\_\+in\+\_\+c/sync/sync.\+h$>$}\newline
{\ttfamily \#include $<$http\+\_\+in\+\_\+c/common/socket\+\_\+functions.\+h$>$}\newline
{\ttfamily \#include $<$http\+\_\+in\+\_\+c/sync/sync\+\_\+internal.\+h$>$}\newline
{\ttfamily \#include $<$http\+\_\+in\+\_\+c/common/alloc.\+h$>$}\newline
{\ttfamily \#include $<$http\+\_\+in\+\_\+c/common/utils.\+h$>$}\newline
{\ttfamily \#include $<$http\+\_\+in\+\_\+c/common/iobuffer.\+h$>$}\newline
{\ttfamily \#include $<$http\+\_\+in\+\_\+c/http\+\_\+protocol/http\+\_\+message\+\_\+parser.\+h$>$}\newline
{\ttfamily \#include $<$rbl/logger.\+h$>$}\newline
{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$unistd.\+h$>$}\newline
{\ttfamily \#include $<$string.\+h$>$}\newline
{\ttfamily \#include $<$assert.\+h$>$}\newline
{\ttfamily \#include $<$errno.\+h$>$}\newline
{\ttfamily \#include $<$rbl/check\+\_\+tag.\+h$>$}\newline
\doxysubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{sync__connection_8c_a92eb8fa965301b67b9913fa69924c98c}{sync\+\_\+connection\+\_\+\+TAG}}~\char`\"{}SYNCCONN\char`\"{}
\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static \mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} \mbox{\hyperlink{sync__connection_8c_a8096cf243a0133fabf9365fd1ef25a5c}{parser\+\_\+on\+\_\+message\+\_\+handler}} (\mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} $\ast$void\+\_\+parser\+\_\+ptr, \mbox{\hyperlink{group__group__message_ga33b8e4c347991edbbe1d3d7d6f77c9a1}{Http\+Message\+Ref}} input\+\_\+message\+\_\+ref)
\item 
static \mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} \mbox{\hyperlink{sync__connection_8c_a52d37baca39ea4ca42bc2131acd2e279}{message\+\_\+dealloc}} (\mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} $\ast$$\ast$p)
\item 
\mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} \mbox{\hyperlink{sync__connection_8c_a0d0f7d156a8d5f4ecc015f0a9fa89526}{sync\+\_\+connection\+\_\+init}} (\mbox{\hyperlink{sync_8h_aa568d18c5bec9a6182859eba28416151}{sync\+\_\+connection\+\_\+t}} $\ast$this, int socketfd, size\+\_\+t read\+\_\+buffer\+\_\+size)
\item 
\mbox{\hyperlink{sync_8h_aa568d18c5bec9a6182859eba28416151}{sync\+\_\+connection\+\_\+t}} $\ast$ \mbox{\hyperlink{sync__connection_8c_a9bc3f22e53b28996293778726a045080}{sync\+\_\+connection\+\_\+new}} (int socketfd, size\+\_\+t read\+\_\+buffer\+\_\+size)
\item 
\mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} \mbox{\hyperlink{sync__connection_8c_a997183b9511b9e4b9fa233f008e5feb7}{sync\+\_\+connection\+\_\+destroy}} (\mbox{\hyperlink{sync_8h_aa568d18c5bec9a6182859eba28416151}{sync\+\_\+connection\+\_\+t}} $\ast$this)
\item 
\mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} \mbox{\hyperlink{sync__connection_8c_afa9c783d85e6c81e10e6c73582278700}{sync\+\_\+connection\+\_\+dispose}} (\mbox{\hyperlink{sync_8h_aa568d18c5bec9a6182859eba28416151}{sync\+\_\+connection\+\_\+t}} $\ast$$\ast$this\+\_\+ptr)
\item 
int \mbox{\hyperlink{sync__connection_8c_ab596957f1f209d2f993e243095151b8d}{sync\+\_\+connection\+\_\+read}} (\mbox{\hyperlink{sync_8h_aa568d18c5bec9a6182859eba28416151}{sync\+\_\+connection\+\_\+t}} $\ast$this)
\item 
int \mbox{\hyperlink{sync__connection_8c_abc2af4de22fc1c594cd28747106503cf}{sync\+\_\+connection\+\_\+read\+\_\+message}} (\mbox{\hyperlink{sync_8h_aa568d18c5bec9a6182859eba28416151}{sync\+\_\+connection\+\_\+t}} $\ast$this, \mbox{\hyperlink{group__group__message_ga33b8e4c347991edbbe1d3d7d6f77c9a1}{Http\+Message\+Ref}} $\ast$msg\+\_\+ptr)
\item 
int \mbox{\hyperlink{sync__connection_8c_ab6a6a328e35a9e2df297063a700e63cb}{sync\+\_\+connection\+\_\+read\+\_\+request}} (\mbox{\hyperlink{sync_8h_aa568d18c5bec9a6182859eba28416151}{sync\+\_\+connection\+\_\+t}} $\ast$this, \mbox{\hyperlink{sync_8h_a8479ab8a913e38cd483bb43672f06a97}{Sync\+Connection\+Server\+Message\+Handler}} \mbox{\hyperlink{w__timerfd_8c_afb76350cb59fd4a3c52022cbee02968f}{handler}}, \mbox{\hyperlink{sync_8h_a752ab692df8a861d059e73584677055e}{sync\+\_\+worker\+\_\+r}} worker\+\_\+ptr)
\item 
int \mbox{\hyperlink{sync__connection_8c_a8777ef11dddd5688da14fa276bf60b6a}{sync\+\_\+connection\+\_\+write}} (\mbox{\hyperlink{sync_8h_aa568d18c5bec9a6182859eba28416151}{sync\+\_\+connection\+\_\+t}} $\ast$this, \mbox{\hyperlink{group__group__message_ga33b8e4c347991edbbe1d3d7d6f77c9a1}{Http\+Message\+Ref}} msg\+\_\+ref)
\item 
\mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} \mbox{\hyperlink{sync__connection_8c_a6d926a8641d111e3fa90aeb68784db8e}{sync\+\_\+connection\+\_\+close}} (\mbox{\hyperlink{sync_8h_aa568d18c5bec9a6182859eba28416151}{sync\+\_\+connection\+\_\+t}} $\ast$this)
\end{DoxyCompactItemize}


\doxysubsection{Macro Definition Documentation}
\mbox{\Hypertarget{sync__connection_8c_a92eb8fa965301b67b9913fa69924c98c}\label{sync__connection_8c_a92eb8fa965301b67b9913fa69924c98c}} 
\index{sync\_connection.c@{sync\_connection.c}!sync\_connection\_TAG@{sync\_connection\_TAG}}
\index{sync\_connection\_TAG@{sync\_connection\_TAG}!sync\_connection.c@{sync\_connection.c}}
\doxysubsubsection{\texorpdfstring{sync\_connection\_TAG}{sync\_connection\_TAG}}
{\footnotesize\ttfamily \#define sync\+\_\+connection\+\_\+\+TAG~\char`\"{}SYNCCONN\char`\"{}}



\doxysubsection{Function Documentation}
\mbox{\Hypertarget{sync__connection_8c_a52d37baca39ea4ca42bc2131acd2e279}\label{sync__connection_8c_a52d37baca39ea4ca42bc2131acd2e279}} 
\index{sync\_connection.c@{sync\_connection.c}!message\_dealloc@{message\_dealloc}}
\index{message\_dealloc@{message\_dealloc}!sync\_connection.c@{sync\_connection.c}}
\doxysubsubsection{\texorpdfstring{message\_dealloc()}{message\_dealloc()}}
{\footnotesize\ttfamily static \mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} message\+\_\+dealloc (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} $\ast$$\ast$}]{p }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

\mbox{\Hypertarget{sync__connection_8c_a8096cf243a0133fabf9365fd1ef25a5c}\label{sync__connection_8c_a8096cf243a0133fabf9365fd1ef25a5c}} 
\index{sync\_connection.c@{sync\_connection.c}!parser\_on\_message\_handler@{parser\_on\_message\_handler}}
\index{parser\_on\_message\_handler@{parser\_on\_message\_handler}!sync\_connection.c@{sync\_connection.c}}
\doxysubsubsection{\texorpdfstring{parser\_on\_message\_handler()}{parser\_on\_message\_handler()}}
{\footnotesize\ttfamily static \mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} parser\+\_\+on\+\_\+message\+\_\+handler (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} $\ast$}]{void\+\_\+parser\+\_\+ptr,  }\item[{\mbox{\hyperlink{group__group__message_ga33b8e4c347991edbbe1d3d7d6f77c9a1}{Http\+Message\+Ref}}}]{input\+\_\+message\+\_\+ref }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

\mbox{\Hypertarget{sync__connection_8c_a6d926a8641d111e3fa90aeb68784db8e}\label{sync__connection_8c_a6d926a8641d111e3fa90aeb68784db8e}} 
\index{sync\_connection.c@{sync\_connection.c}!sync\_connection\_close@{sync\_connection\_close}}
\index{sync\_connection\_close@{sync\_connection\_close}!sync\_connection.c@{sync\_connection.c}}
\doxysubsubsection{\texorpdfstring{sync\_connection\_close()}{sync\_connection\_close()}}
{\footnotesize\ttfamily \mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} sync\+\_\+connection\+\_\+close (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{sync_8h_aa568d18c5bec9a6182859eba28416151}{sync\+\_\+connection\+\_\+t}} $\ast$}]{this }\end{DoxyParamCaption})}

\mbox{\Hypertarget{sync__connection_8c_a997183b9511b9e4b9fa233f008e5feb7}\label{sync__connection_8c_a997183b9511b9e4b9fa233f008e5feb7}} 
\index{sync\_connection.c@{sync\_connection.c}!sync\_connection\_destroy@{sync\_connection\_destroy}}
\index{sync\_connection\_destroy@{sync\_connection\_destroy}!sync\_connection.c@{sync\_connection.c}}
\doxysubsubsection{\texorpdfstring{sync\_connection\_destroy()}{sync\_connection\_destroy()}}
{\footnotesize\ttfamily \mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} sync\+\_\+connection\+\_\+destroy (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{sync_8h_aa568d18c5bec9a6182859eba28416151}{sync\+\_\+connection\+\_\+t}} $\ast$}]{this }\end{DoxyParamCaption})}

\mbox{\Hypertarget{sync__connection_8c_afa9c783d85e6c81e10e6c73582278700}\label{sync__connection_8c_afa9c783d85e6c81e10e6c73582278700}} 
\index{sync\_connection.c@{sync\_connection.c}!sync\_connection\_dispose@{sync\_connection\_dispose}}
\index{sync\_connection\_dispose@{sync\_connection\_dispose}!sync\_connection.c@{sync\_connection.c}}
\doxysubsubsection{\texorpdfstring{sync\_connection\_dispose()}{sync\_connection\_dispose()}}
{\footnotesize\ttfamily \mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} sync\+\_\+connection\+\_\+dispose (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{sync_8h_aa568d18c5bec9a6182859eba28416151}{sync\+\_\+connection\+\_\+t}} $\ast$$\ast$}]{this\+\_\+ptr }\end{DoxyParamCaption})}

\mbox{\Hypertarget{sync__connection_8c_a0d0f7d156a8d5f4ecc015f0a9fa89526}\label{sync__connection_8c_a0d0f7d156a8d5f4ecc015f0a9fa89526}} 
\index{sync\_connection.c@{sync\_connection.c}!sync\_connection\_init@{sync\_connection\_init}}
\index{sync\_connection\_init@{sync\_connection\_init}!sync\_connection.c@{sync\_connection.c}}
\doxysubsubsection{\texorpdfstring{sync\_connection\_init()}{sync\_connection\_init()}}
{\footnotesize\ttfamily \mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} sync\+\_\+connection\+\_\+init (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{sync_8h_aa568d18c5bec9a6182859eba28416151}{sync\+\_\+connection\+\_\+t}} $\ast$}]{this,  }\item[{int}]{socketfd,  }\item[{size\+\_\+t}]{read\+\_\+buffer\+\_\+size }\end{DoxyParamCaption})}

\mbox{\Hypertarget{sync__connection_8c_a9bc3f22e53b28996293778726a045080}\label{sync__connection_8c_a9bc3f22e53b28996293778726a045080}} 
\index{sync\_connection.c@{sync\_connection.c}!sync\_connection\_new@{sync\_connection\_new}}
\index{sync\_connection\_new@{sync\_connection\_new}!sync\_connection.c@{sync\_connection.c}}
\doxysubsubsection{\texorpdfstring{sync\_connection\_new()}{sync\_connection\_new()}}
{\footnotesize\ttfamily \mbox{\hyperlink{sync_8h_aa568d18c5bec9a6182859eba28416151}{sync\+\_\+connection\+\_\+t}}$\ast$ sync\+\_\+connection\+\_\+new (\begin{DoxyParamCaption}\item[{int}]{socketfd,  }\item[{size\+\_\+t}]{read\+\_\+buffer\+\_\+size }\end{DoxyParamCaption})}

\mbox{\Hypertarget{sync__connection_8c_ab596957f1f209d2f993e243095151b8d}\label{sync__connection_8c_ab596957f1f209d2f993e243095151b8d}} 
\index{sync\_connection.c@{sync\_connection.c}!sync\_connection\_read@{sync\_connection\_read}}
\index{sync\_connection\_read@{sync\_connection\_read}!sync\_connection.c@{sync\_connection.c}}
\doxysubsubsection{\texorpdfstring{sync\_connection\_read()}{sync\_connection\_read()}}
{\footnotesize\ttfamily int sync\+\_\+connection\+\_\+read (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{sync_8h_aa568d18c5bec9a6182859eba28416151}{sync\+\_\+connection\+\_\+t}} $\ast$}]{this }\end{DoxyParamCaption})}

this function is private Reads until -\/
\begin{DoxyItemize}
\item the on\+\_\+message\+\_\+callback signals one or more messages have arrived Its signals this by setting this-\/$>$status == 1 and this-\/$>$input\+\_\+message\+\_\+ref != NULL. and The buffer that completed the input message has been consumed by the parser

In this situation the function returns HPE\+\_\+\+OK
\item some kind of io error or parse error. In which case the function returns HPE\+\_\+?? but not HPE\+\_\+\+OK
\end{DoxyItemize}

To the reader -\/ I am sorry this is really arcane \mbox{\Hypertarget{sync__connection_8c_abc2af4de22fc1c594cd28747106503cf}\label{sync__connection_8c_abc2af4de22fc1c594cd28747106503cf}} 
\index{sync\_connection.c@{sync\_connection.c}!sync\_connection\_read\_message@{sync\_connection\_read\_message}}
\index{sync\_connection\_read\_message@{sync\_connection\_read\_message}!sync\_connection.c@{sync\_connection.c}}
\doxysubsubsection{\texorpdfstring{sync\_connection\_read\_message()}{sync\_connection\_read\_message()}}
{\footnotesize\ttfamily int sync\+\_\+connection\+\_\+read\+\_\+message (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{sync_8h_aa568d18c5bec9a6182859eba28416151}{sync\+\_\+connection\+\_\+t}} $\ast$}]{this,  }\item[{\mbox{\hyperlink{group__group__message_ga33b8e4c347991edbbe1d3d7d6f77c9a1}{Http\+Message\+Ref}} $\ast$}]{msg\+\_\+ptr }\end{DoxyParamCaption})}

Gets a message into msg\+\_\+ptr and returns 1, or Puts NULL in msg\+\_\+ptr and returns 0 -\/ io error or parse error -\/ you should close the connection connection\+\_\+read() should have only two possible outcomes\+:
\begin{DoxyEnumerate}
\item got one or more input messages and consumed the most recent buffer without error
\item hit an io error or parse error
\end{DoxyEnumerate}\mbox{\Hypertarget{sync__connection_8c_ab6a6a328e35a9e2df297063a700e63cb}\label{sync__connection_8c_ab6a6a328e35a9e2df297063a700e63cb}} 
\index{sync\_connection.c@{sync\_connection.c}!sync\_connection\_read\_request@{sync\_connection\_read\_request}}
\index{sync\_connection\_read\_request@{sync\_connection\_read\_request}!sync\_connection.c@{sync\_connection.c}}
\doxysubsubsection{\texorpdfstring{sync\_connection\_read\_request()}{sync\_connection\_read\_request()}}
{\footnotesize\ttfamily int sync\+\_\+connection\+\_\+read\+\_\+request (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{sync_8h_aa568d18c5bec9a6182859eba28416151}{sync\+\_\+connection\+\_\+t}} $\ast$}]{this,  }\item[{\mbox{\hyperlink{sync_8h_a8479ab8a913e38cd483bb43672f06a97}{Sync\+Connection\+Server\+Message\+Handler}}}]{handler,  }\item[{\mbox{\hyperlink{sync_8h_a752ab692df8a861d059e73584677055e}{sync\+\_\+worker\+\_\+r}}}]{worker\+\_\+ptr }\end{DoxyParamCaption})}

\mbox{\Hypertarget{sync__connection_8c_a8777ef11dddd5688da14fa276bf60b6a}\label{sync__connection_8c_a8777ef11dddd5688da14fa276bf60b6a}} 
\index{sync\_connection.c@{sync\_connection.c}!sync\_connection\_write@{sync\_connection\_write}}
\index{sync\_connection\_write@{sync\_connection\_write}!sync\_connection.c@{sync\_connection.c}}
\doxysubsubsection{\texorpdfstring{sync\_connection\_write()}{sync\_connection\_write()}}
{\footnotesize\ttfamily int sync\+\_\+connection\+\_\+write (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{sync_8h_aa568d18c5bec9a6182859eba28416151}{sync\+\_\+connection\+\_\+t}} $\ast$}]{this,  }\item[{\mbox{\hyperlink{group__group__message_ga33b8e4c347991edbbe1d3d7d6f77c9a1}{Http\+Message\+Ref}}}]{msg\+\_\+ref }\end{DoxyParamCaption})}

Writes a complete http message to the associated socket and returns a status code to indicate success/io error/connection closed by other end 