\hypertarget{async__handler_8c}{}\doxysection{/home/robert/\+Projects/http\+\_\+in\+\_\+c/http\+\_\+in\+\_\+c/async-\/old/async\+\_\+handler.c File Reference}
\label{async__handler_8c}\index{/home/robert/Projects/http\_in\_c/http\_in\_c/async-\/old/async\_handler.c@{/home/robert/Projects/http\_in\_c/http\_in\_c/async-\/old/async\_handler.c}}
{\ttfamily \#include $<$http\+\_\+in\+\_\+c/async/async.\+h$>$}\newline
{\ttfamily \#include $<$rbl/macros.\+h$>$}\newline
{\ttfamily \#include $<$rbl/check\+\_\+tag.\+h$>$}\newline
{\ttfamily \#include $<$rbl/logger.\+h$>$}\newline
{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$unistd.\+h$>$}\newline
{\ttfamily \#include $<$sys/types.\+h$>$}\newline
{\ttfamily \#include $<$sys/socket.\+h$>$}\newline
{\ttfamily \#include $<$sys/epoll.\+h$>$}\newline
{\ttfamily \#include $<$errno.\+h$>$}\newline
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static \mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} \mbox{\hyperlink{async__handler_8c_aae9f40a232f269fa202c14d55e4abef0}{handle\+\_\+request}} (\mbox{\hyperlink{async_8h_a0c7b3ab54cddeb06a3d86747fccf08e3}{Async\+Handler\+Ref}} href, Message\+Ref request\+\_\+ptr)
\item 
\mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} \mbox{\hyperlink{async__handler_8c_a0727416091fa0115fb7ee3e2a79da853}{async\+\_\+handler\+\_\+handle\+\_\+response}} (\mbox{\hyperlink{async_8h_a0c7b3ab54cddeb06a3d86747fccf08e3}{Async\+Handler\+Ref}} href, Message\+Ref request\+\_\+ptr, Message\+Ref response\+\_\+ptr)
\item 
static \mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} \mbox{\hyperlink{async__handler_8c_aed3398b21cdfe40024f0350fad3af819}{handle\+\_\+write\+\_\+complete}} (\mbox{\hyperlink{async_8h_a0c7b3ab54cddeb06a3d86747fccf08e3}{Async\+Handler\+Ref}} href)
\item 
static \mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} \mbox{\hyperlink{async__handler_8c_ae0c961d5b89c58bfde0aecbfd4b63347}{handle\+\_\+close\+\_\+connection}} (\mbox{\hyperlink{async_8h_a0c7b3ab54cddeb06a3d86747fccf08e3}{Async\+Handler\+Ref}} href)
\item 
static \mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} \mbox{\hyperlink{async__handler_8c_ab40f3a9942fc576d8b9a61f5d4b25887}{postable\+\_\+write\+\_\+start}} (\mbox{\hyperlink{group__runloop_ga3be36d97cf9a7f7b4180b71d95cde72e}{Runloop\+Ref}} reactor\+\_\+ref, \mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} $\ast$href)
\item 
static \mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} \mbox{\hyperlink{async__handler_8c_a809bf1387a068be935dc7a38b3e137ab}{on\+\_\+write\+\_\+complete\+\_\+cb}} (\mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} $\ast$href, int status)
\item 
static \mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} \mbox{\hyperlink{async__handler_8c_a6b6fd0969ba21f0617b21820d8bc0608}{handler\+\_\+postable\+\_\+read\+\_\+start}} (\mbox{\hyperlink{group__runloop_ga3be36d97cf9a7f7b4180b71d95cde72e}{Runloop\+Ref}} reactor\+\_\+ref, \mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} $\ast$href)
\item 
\mbox{\hyperlink{async_8h_a0c7b3ab54cddeb06a3d86747fccf08e3}{Async\+Handler\+Ref}} \mbox{\hyperlink{async__handler_8c_a8c162987f1bf747fff537a2d3d5a644b}{async\+\_\+handler\+\_\+new}} (int socket, \mbox{\hyperlink{group__runloop_ga3be36d97cf9a7f7b4180b71d95cde72e}{Runloop\+Ref}} reactor\+\_\+ref, \mbox{\hyperlink{async_8h_aa2dffdb66273f9a25f9e23ca2d2a93fb}{Async\+Server\+Ref}} server\+\_\+ref)
\item 
\mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} \mbox{\hyperlink{async__handler_8c_ada9a2095ce211ce606747c6a605196a6}{async\+\_\+handler\+\_\+init}} (\mbox{\hyperlink{async_8h_a0c7b3ab54cddeb06a3d86747fccf08e3}{Async\+Handler\+Ref}} this, int socket, \mbox{\hyperlink{group__runloop_ga3be36d97cf9a7f7b4180b71d95cde72e}{Runloop\+Ref}} reactor\+\_\+ref, \mbox{\hyperlink{async_8h_aa2dffdb66273f9a25f9e23ca2d2a93fb}{Async\+Server\+Ref}} server\+\_\+ref)
\item 
\mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} \mbox{\hyperlink{async__handler_8c_abdd1e94f3ea8431898c8e4c851bcb099}{async\+\_\+handler\+\_\+destroy}} (\mbox{\hyperlink{async_8h_a0c7b3ab54cddeb06a3d86747fccf08e3}{Async\+Handler\+Ref}} this)
\item 
\mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} \mbox{\hyperlink{async__handler_8c_af309ff75d64a426468dd92aa046d7c52}{async\+\_\+handler\+\_\+free}} (\mbox{\hyperlink{async_8h_a0c7b3ab54cddeb06a3d86747fccf08e3}{Async\+Handler\+Ref}} this)
\item 
\mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} \mbox{\hyperlink{async__handler_8c_abce75a25492e4c47f912c4cabf743e70}{async\+\_\+handler\+\_\+anonymous\+\_\+dispose}} (\mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} $\ast$$\ast$p)
\item 
int \mbox{\hyperlink{async__handler_8c_a58b54e430960ff774c07cd36b7321687}{async\+\_\+handler\+\_\+threadid}} (\mbox{\hyperlink{async_8h_a0c7b3ab54cddeb06a3d86747fccf08e3}{Async\+Handler\+Ref}} handler\+\_\+ref)
\end{DoxyCompactItemize}


\doxysubsection{Function Documentation}
\mbox{\Hypertarget{async__handler_8c_abce75a25492e4c47f912c4cabf743e70}\label{async__handler_8c_abce75a25492e4c47f912c4cabf743e70}} 
\index{async\_handler.c@{async\_handler.c}!async\_handler\_anonymous\_dispose@{async\_handler\_anonymous\_dispose}}
\index{async\_handler\_anonymous\_dispose@{async\_handler\_anonymous\_dispose}!async\_handler.c@{async\_handler.c}}
\doxysubsubsection{\texorpdfstring{async\_handler\_anonymous\_dispose()}{async\_handler\_anonymous\_dispose()}}
{\footnotesize\ttfamily \mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} async\+\_\+handler\+\_\+anonymous\+\_\+dispose (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} $\ast$$\ast$}]{p }\end{DoxyParamCaption})}

\mbox{\Hypertarget{async__handler_8c_abdd1e94f3ea8431898c8e4c851bcb099}\label{async__handler_8c_abdd1e94f3ea8431898c8e4c851bcb099}} 
\index{async\_handler.c@{async\_handler.c}!async\_handler\_destroy@{async\_handler\_destroy}}
\index{async\_handler\_destroy@{async\_handler\_destroy}!async\_handler.c@{async\_handler.c}}
\doxysubsubsection{\texorpdfstring{async\_handler\_destroy()}{async\_handler\_destroy()}}
{\footnotesize\ttfamily \mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} async\+\_\+handler\+\_\+destroy (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{async_8h_a0c7b3ab54cddeb06a3d86747fccf08e3}{Async\+Handler\+Ref}}}]{this }\end{DoxyParamCaption})}

\mbox{\Hypertarget{async__handler_8c_af309ff75d64a426468dd92aa046d7c52}\label{async__handler_8c_af309ff75d64a426468dd92aa046d7c52}} 
\index{async\_handler.c@{async\_handler.c}!async\_handler\_free@{async\_handler\_free}}
\index{async\_handler\_free@{async\_handler\_free}!async\_handler.c@{async\_handler.c}}
\doxysubsubsection{\texorpdfstring{async\_handler\_free()}{async\_handler\_free()}}
{\footnotesize\ttfamily \mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} async\+\_\+handler\+\_\+free (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{async_8h_a0c7b3ab54cddeb06a3d86747fccf08e3}{Async\+Handler\+Ref}}}]{this }\end{DoxyParamCaption})}

\mbox{\Hypertarget{async__handler_8c_a0727416091fa0115fb7ee3e2a79da853}\label{async__handler_8c_a0727416091fa0115fb7ee3e2a79da853}} 
\index{async\_handler.c@{async\_handler.c}!async\_handler\_handle\_response@{async\_handler\_handle\_response}}
\index{async\_handler\_handle\_response@{async\_handler\_handle\_response}!async\_handler.c@{async\_handler.c}}
\doxysubsubsection{\texorpdfstring{async\_handler\_handle\_response()}{async\_handler\_handle\_response()}}
{\footnotesize\ttfamily \mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} async\+\_\+handler\+\_\+handle\+\_\+response (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{async_8h_a0c7b3ab54cddeb06a3d86747fccf08e3}{Async\+Handler\+Ref}}}]{href,  }\item[{Message\+Ref}]{request\+\_\+ptr,  }\item[{Message\+Ref}]{response\+\_\+ptr }\end{DoxyParamCaption})}

Called by process\+\_\+request() after it has constructed the response message to have the response sent to the client \mbox{\Hypertarget{async__handler_8c_ada9a2095ce211ce606747c6a605196a6}\label{async__handler_8c_ada9a2095ce211ce606747c6a605196a6}} 
\index{async\_handler.c@{async\_handler.c}!async\_handler\_init@{async\_handler\_init}}
\index{async\_handler\_init@{async\_handler\_init}!async\_handler.c@{async\_handler.c}}
\doxysubsubsection{\texorpdfstring{async\_handler\_init()}{async\_handler\_init()}}
{\footnotesize\ttfamily \mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} async\+\_\+handler\+\_\+init (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{async_8h_a0c7b3ab54cddeb06a3d86747fccf08e3}{Async\+Handler\+Ref}}}]{this,  }\item[{int}]{socket,  }\item[{\mbox{\hyperlink{group__runloop_ga3be36d97cf9a7f7b4180b71d95cde72e}{Runloop\+Ref}}}]{reactor\+\_\+ref,  }\item[{\mbox{\hyperlink{async_8h_aa2dffdb66273f9a25f9e23ca2d2a93fb}{Async\+Server\+Ref}}}]{server\+\_\+ref }\end{DoxyParamCaption})}

\mbox{\Hypertarget{async__handler_8c_a8c162987f1bf747fff537a2d3d5a644b}\label{async__handler_8c_a8c162987f1bf747fff537a2d3d5a644b}} 
\index{async\_handler.c@{async\_handler.c}!async\_handler\_new@{async\_handler\_new}}
\index{async\_handler\_new@{async\_handler\_new}!async\_handler.c@{async\_handler.c}}
\doxysubsubsection{\texorpdfstring{async\_handler\_new()}{async\_handler\_new()}}
{\footnotesize\ttfamily \mbox{\hyperlink{async_8h_a0c7b3ab54cddeb06a3d86747fccf08e3}{Async\+Handler\+Ref}} async\+\_\+handler\+\_\+new (\begin{DoxyParamCaption}\item[{int}]{socket,  }\item[{\mbox{\hyperlink{group__runloop_ga3be36d97cf9a7f7b4180b71d95cde72e}{Runloop\+Ref}}}]{reactor\+\_\+ref,  }\item[{\mbox{\hyperlink{async_8h_aa2dffdb66273f9a25f9e23ca2d2a93fb}{Async\+Server\+Ref}}}]{server\+\_\+ref }\end{DoxyParamCaption})}

\mbox{\Hypertarget{async__handler_8c_a58b54e430960ff774c07cd36b7321687}\label{async__handler_8c_a58b54e430960ff774c07cd36b7321687}} 
\index{async\_handler.c@{async\_handler.c}!async\_handler\_threadid@{async\_handler\_threadid}}
\index{async\_handler\_threadid@{async\_handler\_threadid}!async\_handler.c@{async\_handler.c}}
\doxysubsubsection{\texorpdfstring{async\_handler\_threadid()}{async\_handler\_threadid()}}
{\footnotesize\ttfamily int async\+\_\+handler\+\_\+threadid (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{async_8h_a0c7b3ab54cddeb06a3d86747fccf08e3}{Async\+Handler\+Ref}}}]{handler\+\_\+ref }\end{DoxyParamCaption})}

\mbox{\Hypertarget{async__handler_8c_ae0c961d5b89c58bfde0aecbfd4b63347}\label{async__handler_8c_ae0c961d5b89c58bfde0aecbfd4b63347}} 
\index{async\_handler.c@{async\_handler.c}!handle\_close\_connection@{handle\_close\_connection}}
\index{handle\_close\_connection@{handle\_close\_connection}!async\_handler.c@{async\_handler.c}}
\doxysubsubsection{\texorpdfstring{handle\_close\_connection()}{handle\_close\_connection()}}
{\footnotesize\ttfamily static \mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} handle\+\_\+close\+\_\+connection (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{async_8h_a0c7b3ab54cddeb06a3d86747fccf08e3}{Async\+Handler\+Ref}}}]{href }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

Called by async\+\_\+connection when the connection is ready to be closed and no more activity will take place. Such as after an io error or peer closed connection

Handler should call the server\+\_\+ref-\/$>$handler\+\_\+complete() which will async\+\_\+handler\+\_\+dispose() the handler which will async\+\_\+connection\+\_\+dipose() the connection which will close() the connection.

After this chain of disposes no activity should take place with the connection, handler or runloop.

NOTE\+: this function should be called directly from the runloop (ie posted) so that when it returns no other async\+\_\+connection or async\+\_\+handler code is executed for this socket. \mbox{\Hypertarget{async__handler_8c_aae9f40a232f269fa202c14d55e4abef0}\label{async__handler_8c_aae9f40a232f269fa202c14d55e4abef0}} 
\index{async\_handler.c@{async\_handler.c}!handle\_request@{handle\_request}}
\index{handle\_request@{handle\_request}!async\_handler.c@{async\_handler.c}}
\doxysubsubsection{\texorpdfstring{handle\_request()}{handle\_request()}}
{\footnotesize\ttfamily static \mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} handle\+\_\+request (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{async_8h_a0c7b3ab54cddeb06a3d86747fccf08e3}{Async\+Handler\+Ref}}}]{href,  }\item[{Message\+Ref}]{request\+\_\+ptr }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

Called by async\+\_\+connection when a new message arrives \mbox{\Hypertarget{async__handler_8c_aed3398b21cdfe40024f0350fad3af819}\label{async__handler_8c_aed3398b21cdfe40024f0350fad3af819}} 
\index{async\_handler.c@{async\_handler.c}!handle\_write\_complete@{handle\_write\_complete}}
\index{handle\_write\_complete@{handle\_write\_complete}!async\_handler.c@{async\_handler.c}}
\doxysubsubsection{\texorpdfstring{handle\_write\_complete()}{handle\_write\_complete()}}
{\footnotesize\ttfamily static \mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} handle\+\_\+write\+\_\+complete (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{async_8h_a0c7b3ab54cddeb06a3d86747fccf08e3}{Async\+Handler\+Ref}}}]{href }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

Called by async\+\_\+connection when writing of the response is complete \mbox{\Hypertarget{async__handler_8c_a6b6fd0969ba21f0617b21820d8bc0608}\label{async__handler_8c_a6b6fd0969ba21f0617b21820d8bc0608}} 
\index{async\_handler.c@{async\_handler.c}!handler\_postable\_read\_start@{handler\_postable\_read\_start}}
\index{handler\_postable\_read\_start@{handler\_postable\_read\_start}!async\_handler.c@{async\_handler.c}}
\doxysubsubsection{\texorpdfstring{handler\_postable\_read\_start()}{handler\_postable\_read\_start()}}
{\footnotesize\ttfamily static \mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} handler\+\_\+postable\+\_\+read\+\_\+start (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{group__runloop_ga3be36d97cf9a7f7b4180b71d95cde72e}{Runloop\+Ref}}}]{reactor\+\_\+ref,  }\item[{\mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} $\ast$}]{href }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

\mbox{\Hypertarget{async__handler_8c_a809bf1387a068be935dc7a38b3e137ab}\label{async__handler_8c_a809bf1387a068be935dc7a38b3e137ab}} 
\index{async\_handler.c@{async\_handler.c}!on\_write\_complete\_cb@{on\_write\_complete\_cb}}
\index{on\_write\_complete\_cb@{on\_write\_complete\_cb}!async\_handler.c@{async\_handler.c}}
\doxysubsubsection{\texorpdfstring{on\_write\_complete\_cb()}{on\_write\_complete\_cb()}}
{\footnotesize\ttfamily static \mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} on\+\_\+write\+\_\+complete\+\_\+cb (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} $\ast$}]{href,  }\item[{int}]{status }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

\mbox{\Hypertarget{async__handler_8c_ab40f3a9942fc576d8b9a61f5d4b25887}\label{async__handler_8c_ab40f3a9942fc576d8b9a61f5d4b25887}} 
\index{async\_handler.c@{async\_handler.c}!postable\_write\_start@{postable\_write\_start}}
\index{postable\_write\_start@{postable\_write\_start}!async\_handler.c@{async\_handler.c}}
\doxysubsubsection{\texorpdfstring{postable\_write\_start()}{postable\_write\_start()}}
{\footnotesize\ttfamily static \mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} postable\+\_\+write\+\_\+start (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{group__runloop_ga3be36d97cf9a7f7b4180b71d95cde72e}{Runloop\+Ref}}}]{reactor\+\_\+ref,  }\item[{\mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} $\ast$}]{href }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

