\hypertarget{worker_8c}{}\doxysection{/home/robert/\+Projects/http\+\_\+in\+\_\+c/http\+\_\+in\+\_\+c/sync/worker.c File Reference}
\label{worker_8c}\index{/home/robert/Projects/http\_in\_c/http\_in\_c/sync/worker.c@{/home/robert/Projects/http\_in\_c/http\_in\_c/sync/worker.c}}
{\ttfamily \#include $<$http\+\_\+in\+\_\+c/sync/sync.\+h$>$}\newline
{\ttfamily \#include $<$http\+\_\+in\+\_\+c/sync/sync\+\_\+internal.\+h$>$}\newline
{\ttfamily \#include $<$http\+\_\+in\+\_\+c/common/alloc.\+h$>$}\newline
{\ttfamily \#include $<$http\+\_\+in\+\_\+c/common/utils.\+h$>$}\newline
{\ttfamily \#include $<$http\+\_\+in\+\_\+c/common/queue.\+h$>$}\newline
{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include $<$unistd.\+h$>$}\newline
{\ttfamily \#include $<$assert.\+h$>$}\newline
{\ttfamily \#include $<$pthread.\+h$>$}\newline
{\ttfamily \#include $<$rbl/macros.\+h$>$}\newline
{\ttfamily \#include $<$rbl/logger.\+h$>$}\newline
{\ttfamily \#include $<$rbl/check\+\_\+tag.\+h$>$}\newline
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static int \mbox{\hyperlink{worker_8c_a147f84824eaf961ee0be4a5b84430f8d}{on\+\_\+message\+\_\+handler\+\_\+2}} (\mbox{\hyperlink{group__group__message_ga33b8e4c347991edbbe1d3d7d6f77c9a1}{Http\+Message\+Ref}} response\+\_\+ptr, \mbox{\hyperlink{sync_8h_a021702523caac68049d2ac01aa8e317c}{sync\+\_\+worker\+\_\+t}} $\ast$context)
\item 
static int \mbox{\hyperlink{worker_8c_a468dfd8b17fe4455d4ee9edf1681652d}{connection\+\_\+message\+\_\+handler}} (\mbox{\hyperlink{group__group__message_ga33b8e4c347991edbbe1d3d7d6f77c9a1}{Http\+Message\+Ref}} request\+\_\+ptr, \mbox{\hyperlink{sync_8h_a752ab692df8a861d059e73584677055e}{sync\+\_\+worker\+\_\+r}} context)
\item 
\mbox{\hyperlink{sync_8h_a752ab692df8a861d059e73584677055e}{sync\+\_\+worker\+\_\+r}} \mbox{\hyperlink{worker_8c_ae53a57622d7a531ef6f263400e3e2701}{sync\+\_\+worker\+\_\+new}} (int listen\+\_\+socket, int ident, size\+\_\+t read\+\_\+buffer\+\_\+size, \mbox{\hyperlink{sync_8h_ac3206246f99ad03084983d477968c826}{Sync\+App\+Message\+Handler}} app\+\_\+handler)
\item 
\mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} \mbox{\hyperlink{worker_8c_a85d599345bf06d6e690cdaf2ee71eaee}{sync\+\_\+worker\+\_\+dispose}} (\mbox{\hyperlink{sync_8h_a752ab692df8a861d059e73584677055e}{sync\+\_\+worker\+\_\+r}} wref)
\item 
static \mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} $\ast$ \mbox{\hyperlink{worker_8c_a8613300b9965b70ad6d2560b27e86d81}{Worker\+\_\+main}} (\mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} $\ast$data)
\item 
int \mbox{\hyperlink{worker_8c_a479bab3b4bd0b89bd19b2b378399f57c}{sync\+\_\+worker\+\_\+start}} (\mbox{\hyperlink{sync_8h_a752ab692df8a861d059e73584677055e}{sync\+\_\+worker\+\_\+r}} wref)
\item 
int \mbox{\hyperlink{worker_8c_a5b42c60028ca16aacb842f2276d81724}{sync\+\_\+worker\+\_\+socketfd}} (\mbox{\hyperlink{sync_8h_a752ab692df8a861d059e73584677055e}{sync\+\_\+worker\+\_\+r}} wref)
\item 
pthread\+\_\+t \mbox{\hyperlink{worker_8c_a73763560a91e909a64860ba63ccd7c6e}{sync\+\_\+worker\+\_\+pthread}} (\mbox{\hyperlink{sync_8h_a752ab692df8a861d059e73584677055e}{sync\+\_\+worker\+\_\+r}} wref)
\item 
\mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} \mbox{\hyperlink{worker_8c_a6752f79a63aa1b11deca95d1caf755f5}{sync\+\_\+worker\+\_\+join}} (\mbox{\hyperlink{sync_8h_a752ab692df8a861d059e73584677055e}{sync\+\_\+worker\+\_\+r}} wref)
\end{DoxyCompactItemize}


\doxysubsection{Function Documentation}
\mbox{\Hypertarget{worker_8c_a468dfd8b17fe4455d4ee9edf1681652d}\label{worker_8c_a468dfd8b17fe4455d4ee9edf1681652d}} 
\index{worker.c@{worker.c}!connection\_message\_handler@{connection\_message\_handler}}
\index{connection\_message\_handler@{connection\_message\_handler}!worker.c@{worker.c}}
\doxysubsubsection{\texorpdfstring{connection\_message\_handler()}{connection\_message\_handler()}}
{\footnotesize\ttfamily static int connection\+\_\+message\+\_\+handler (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{group__group__message_ga33b8e4c347991edbbe1d3d7d6f77c9a1}{Http\+Message\+Ref}}}]{request\+\_\+ptr,  }\item[{\mbox{\hyperlink{sync_8h_a752ab692df8a861d059e73584677055e}{sync\+\_\+worker\+\_\+r}}}]{context }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

\mbox{\Hypertarget{worker_8c_a147f84824eaf961ee0be4a5b84430f8d}\label{worker_8c_a147f84824eaf961ee0be4a5b84430f8d}} 
\index{worker.c@{worker.c}!on\_message\_handler\_2@{on\_message\_handler\_2}}
\index{on\_message\_handler\_2@{on\_message\_handler\_2}!worker.c@{worker.c}}
\doxysubsubsection{\texorpdfstring{on\_message\_handler\_2()}{on\_message\_handler\_2()}}
{\footnotesize\ttfamily static int on\+\_\+message\+\_\+handler\+\_\+2 (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{group__group__message_ga33b8e4c347991edbbe1d3d7d6f77c9a1}{Http\+Message\+Ref}}}]{response\+\_\+ptr,  }\item[{\mbox{\hyperlink{sync_8h_a021702523caac68049d2ac01aa8e317c}{sync\+\_\+worker\+\_\+t}} $\ast$}]{context }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

\mbox{\Hypertarget{worker_8c_a85d599345bf06d6e690cdaf2ee71eaee}\label{worker_8c_a85d599345bf06d6e690cdaf2ee71eaee}} 
\index{worker.c@{worker.c}!sync\_worker\_dispose@{sync\_worker\_dispose}}
\index{sync\_worker\_dispose@{sync\_worker\_dispose}!worker.c@{worker.c}}
\doxysubsubsection{\texorpdfstring{sync\_worker\_dispose()}{sync\_worker\_dispose()}}
{\footnotesize\ttfamily \mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} sync\+\_\+worker\+\_\+dispose (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{sync_8h_a752ab692df8a861d059e73584677055e}{sync\+\_\+worker\+\_\+r}}}]{wref }\end{DoxyParamCaption})}

\mbox{\Hypertarget{worker_8c_a6752f79a63aa1b11deca95d1caf755f5}\label{worker_8c_a6752f79a63aa1b11deca95d1caf755f5}} 
\index{worker.c@{worker.c}!sync\_worker\_join@{sync\_worker\_join}}
\index{sync\_worker\_join@{sync\_worker\_join}!worker.c@{worker.c}}
\doxysubsubsection{\texorpdfstring{sync\_worker\_join()}{sync\_worker\_join()}}
{\footnotesize\ttfamily \mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} sync\+\_\+worker\+\_\+join (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{sync_8h_a752ab692df8a861d059e73584677055e}{sync\+\_\+worker\+\_\+r}}}]{wref }\end{DoxyParamCaption})}

\mbox{\Hypertarget{worker_8c_ae53a57622d7a531ef6f263400e3e2701}\label{worker_8c_ae53a57622d7a531ef6f263400e3e2701}} 
\index{worker.c@{worker.c}!sync\_worker\_new@{sync\_worker\_new}}
\index{sync\_worker\_new@{sync\_worker\_new}!worker.c@{worker.c}}
\doxysubsubsection{\texorpdfstring{sync\_worker\_new()}{sync\_worker\_new()}}
{\footnotesize\ttfamily \mbox{\hyperlink{sync_8h_a752ab692df8a861d059e73584677055e}{sync\+\_\+worker\+\_\+r}} sync\+\_\+worker\+\_\+new (\begin{DoxyParamCaption}\item[{int}]{listen\+\_\+socket,  }\item[{int}]{ident,  }\item[{size\+\_\+t}]{read\+\_\+buffer\+\_\+size,  }\item[{\mbox{\hyperlink{sync_8h_ac3206246f99ad03084983d477968c826}{Sync\+App\+Message\+Handler}}}]{app\+\_\+handler }\end{DoxyParamCaption})}

SYNC\+\_\+\+WORKER\+\_\+\+QUEUE

there are 2 ways that the server and worker can interact in regard to listening for incoming connections.
\begin{DoxyItemize}
\item the first method SYNC\+\_\+\+WORKER\+\_\+\+QUEUE is defined. The main thread does the listening and when a connection is made it passes the socket to a worker thread via a synchronized queue
\item the second method SYNC\+\_\+\+WORKER\+\_\+\+QUEUE NOT defined -\/ the main thread creates the listener socket but each worker issues its own accept() call -\/ the Linux OS ensures that only one thread waiting for an incoming connection will be worken up to handle the connection. The main thread does nothing after starting the worker threads. It joust issues pthread\+\_\+join() calls to wait for all the workers to terminate. 
\end{DoxyItemize}\mbox{\Hypertarget{worker_8c_a73763560a91e909a64860ba63ccd7c6e}\label{worker_8c_a73763560a91e909a64860ba63ccd7c6e}} 
\index{worker.c@{worker.c}!sync\_worker\_pthread@{sync\_worker\_pthread}}
\index{sync\_worker\_pthread@{sync\_worker\_pthread}!worker.c@{worker.c}}
\doxysubsubsection{\texorpdfstring{sync\_worker\_pthread()}{sync\_worker\_pthread()}}
{\footnotesize\ttfamily pthread\+\_\+t sync\+\_\+worker\+\_\+pthread (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{sync_8h_a752ab692df8a861d059e73584677055e}{sync\+\_\+worker\+\_\+r}}}]{wref }\end{DoxyParamCaption})}

\mbox{\Hypertarget{worker_8c_a5b42c60028ca16aacb842f2276d81724}\label{worker_8c_a5b42c60028ca16aacb842f2276d81724}} 
\index{worker.c@{worker.c}!sync\_worker\_socketfd@{sync\_worker\_socketfd}}
\index{sync\_worker\_socketfd@{sync\_worker\_socketfd}!worker.c@{worker.c}}
\doxysubsubsection{\texorpdfstring{sync\_worker\_socketfd()}{sync\_worker\_socketfd()}}
{\footnotesize\ttfamily int sync\+\_\+worker\+\_\+socketfd (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{sync_8h_a752ab692df8a861d059e73584677055e}{sync\+\_\+worker\+\_\+r}}}]{wref }\end{DoxyParamCaption})}

\mbox{\Hypertarget{worker_8c_a479bab3b4bd0b89bd19b2b378399f57c}\label{worker_8c_a479bab3b4bd0b89bd19b2b378399f57c}} 
\index{worker.c@{worker.c}!sync\_worker\_start@{sync\_worker\_start}}
\index{sync\_worker\_start@{sync\_worker\_start}!worker.c@{worker.c}}
\doxysubsubsection{\texorpdfstring{sync\_worker\_start()}{sync\_worker\_start()}}
{\footnotesize\ttfamily int sync\+\_\+worker\+\_\+start (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{sync_8h_a752ab692df8a861d059e73584677055e}{sync\+\_\+worker\+\_\+r}}}]{wref }\end{DoxyParamCaption})}

\mbox{\Hypertarget{worker_8c_a8613300b9965b70ad6d2560b27e86d81}\label{worker_8c_a8613300b9965b70ad6d2560b27e86d81}} 
\index{worker.c@{worker.c}!Worker\_main@{Worker\_main}}
\index{Worker\_main@{Worker\_main}!worker.c@{worker.c}}
\doxysubsubsection{\texorpdfstring{Worker\_main()}{Worker\_main()}}
{\footnotesize\ttfamily static \mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}}$\ast$ Worker\+\_\+main (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{rl__internal_8h_a691e4d5de4b427a20b12e6a256b5406e}{void}} $\ast$}]{data }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

this is the terminate signal